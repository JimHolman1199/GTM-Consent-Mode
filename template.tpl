___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.

___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "__wm": "VGVtcGFsdGUtQXV0aG9yX0NvbnNlbnRNb2RlLVNpbW8tQWhhdmE\u003d",
  "version": 1,
  "securityGroups": [],
  "displayName": "Google Consent state",
  "categories": [
    "UTILITY",
    "ANALYTICS",
    "ADVERTISING"
  ],
  "brand": {
    "id": "github.com_gtm-templates-simo-ahava",
    "displayName": "Minech",
    "thumbnail": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQ4AAAEOCAYAAAB4sfmlAAAAAXNSR0IArs4c6QAAG9RJREFUeF7tnVnPFEUUhgs+UAQRUQPKJiJrWBRlEWULQbhQiQICidErE70zJib8AS9NjEZ/gTcgCNFoIruKgKAgKAgIyG4UjBuuIGLeiUOGYbq7Tm1d1fNWYrz4uuqceuvUw+meWjp1dHRcUixUgApQAYECnQgOgVp8lApQgZoCBAcDgQpQAbECBIdYMlagAlSA4GAMUAEqIFaA4BBLxgpUgAoQHIwBKkAFxAoQHGLJWIEKUAGCgzFABaiAWAGCQywZK1ABKkBwMAaoABUQK0BwiCVjBSpABQgOxgAVoAJiBQgOsWSsQAWoAMHBGKACVECsAMEhlowVqAAVIDgYA1SACogVIDjEkrECFaACBAdjgApQAbECBIdYMlagAlSA4GAMUAEqIFaA4BBLxgpUgAoQHIwBKkAFxAoQHGLJWIEKUAGCgzFABaiAWAGCQywZK1ABKkBwMAaoABUQK0BwiCVjBSpABQgOxgAVoAJiBQgOsWSsQAWoAMHBGKACVECsAMEhlowVqAAVIDgYA1SACogVIDjEkrECFUhfgUuXLl3uRKdOnQo71Pw8wVEoGR+gAtVQAJNfBxI6vSU4dFTiM1QgUQVcwqJRAoIj0YCg21QgTwFfwKjbJDgYf1SgQgr4BgbBUaFgYVeoABQIBQ3YYsbBmKMCiSsQEhjMOBIPFrpPBUJnGfw4ypijAhVQoIxMgxlHBQKHXaACZSnAbxxlKU+7VCBhBQiOhAePrrefAmW+nvAbR/vFG3tcAQVigQZ/jq1AMLEL7aFATNAgONoj5tjLCipQ360q2bTWWMe2Pr9xVDCo2KVqKVDPNlxnHTbtERzVijH2pmIK/Pvvv6pz587eeyWFCMHhfUhogArIFZBOZLmF1jV07RIcrhRnO1TAgQK6E9eBqdwmivwgOHyPANunApoKFE1WzWaCPEZwBJGZRqhAtgKxA6OVfwQHI5oKlKhA7NDIkobgKDFoaLq9FUgVGhg1gqO9Y5e9pwJGChAcRrKxEhVobwUIjvYef/Y+sAIpv540SkVwBA4cmmtfBaoCDX7jaN8YZs8DK1AlaBAcgYOH5qiAKwVsd7fa+sFXFVsFWZ8KFCjgKttw1U7dXZv22h4cL730kurWrVupwf/CCy+ov/76q1QfUjL++uuv1y4fKqt07dpVPfPMM1rmbSYnDNjW13LSwE7bg2Pp0qVqzJgx6tprr9XV2Olzf//9t3rttdfU9u3bnbZb1cYGDx6snn/+eXXbbbeV1sULFy6oJ554wqv9UMBo7oSuXYJj6VI1ZcoUdf78ea+BkNU4wLFhwwb15ptvqj/++KMUH1IxitOuFi5cqKZOnVoaODBePXr0UPPnzy+UTXcSNjZkUqfQEYMHivwgOJYuVc8++6z66KOP1HXXXWcgsV0VBOKmTZvU4cOHaz6wZCswYsQI9cADD6i77rqrNHAMGzZMHT16VAscVR5LguN/cBw4cECdO3cu+FjXwQHCr1q1Sv3yyy/BfUjBYEdHh1q0aFEN7mWB459//qllp59//nkhOIr+xY4xy8iKA+6ObaEMvnEg40D58MMPVffu3YPOozo4YPTkyZNq3bp1Qe2nYmzcuHFqwoQJNXfLAAeO8IMPAJcOOFLR1dRPZhwN4Dh+/Lg6c+aMqZZG9RrBgQbee+899f333xu1VdVK+BVjyZIlCv8vCxz4V3fSpEk1+wQHd8eqxowDQRH6W0czOH744Qf1zjvvVJUBRv2aOHGiGjt27OW6oTMOfDi/7777FF6XdMAheU0xEiSCSsw4GjIOjMd3331Xe2UIVZrBAbvr169XJ06cCOVC1HbwaoBvG/VJW0bG0aVLFzV+/PjLOjHjYMZxVcaB6Ni8eXOwRWGtwIEPpPhQWuYip1hogp9ehw8ffoU7ITMOLMyDD40XHxEcBEdLcPz444/qyJEjQeZOK3DU4XXo0KEgPsRqpFevXrVfL5pvKwsJDnwsHz169BUS5YGjHV5TIAZfVZpeVeoRsmXLFnXNNdd4n1NZ4MBiMCwKw9f8di2zZs1SWCnaXEKB488//1TTp0+/yr4JOKoGFIIjAxy///672rdv31X/2rmexFnggB0sQ4cP7VhuueUWNW/evJZdDwWOm2++WQ0ZMsQJOHyMYZk7ZAmODHDUJ67v6/fywIG/LV++XGHhUbuVhx56SPXt27c0cGRlG3CozG8crjMX0/YIjhxwYMLu2LHj8voBH5M3Dxywt3v3brVr1y4fpqNts3///mru3LmZ/oXIOPr166fgR6siAYfpxGy066INncGW2CE4csABsTFpL168qKO70TNF4AC8VqxYofAvYLuUxx57TPXu3bs0cOCXlGnTpmXal4DDZswkE9nGTnNdHbsERwE4IOLHH3/s7efZInBgUPfv36+2bdvmMjaibQvfFGbOnJnrn++M44477lD4xpJVdMGhMwFb2TCt53pQ8/wgOArAgcHYu3evt3/xdcCBAVy5cmUpm/BcB2Nee/Vt8z179iwNHBgPrNvIK7rgCKldaFsEhwY4MCi+NsDpgAP2v/nmG/XBBx+Ejo+g9kaNGlXbfVpUfGYc2Lp/ww03WINDmjVIny/SyPXfm/0jODTBgcVYP//8s+vxULrggOHVq1ern376ybkPMTSIZd2PP/641pkovsCBb1nYk1JUmHFwAVjLlaNZgeMj65CA49SpU2rt2rVFcZ3k3++++251zz33aPnuAxz4CA37OkdIEhwEhwgc2Hjmesu7BByYVVXcdo/JunjxYoWsQ6f4AAe+r9TP+yjyoQgcsb92FPVP5+98VdF8VamL6XrbvRQcVdx2P3ny5Kv2g+QFr2twYAxwJGHznpgsH0yWnOtMxpSeITiE4Dh79qw6duyYszGWggOGN27c6NQHZ50xaAibyLBtXrJC1zU4kPHgdC/dUpRx6LaT8nMEhxAcGGys69B5F9YJDBNwVGnbPRZa4QBgSXEJjryl5SYZBzYlSiAo6XdMzxIcBuDAxP3666+djKMJOOrwcuWDk44YNJK1bb6oKZfgwJqRkSNHFpm84u+mrypV+vZBcBiAA1GElZy6H/PyotIUHPiXEtvufS6HF80mg4dnz56tBg0aJK7pChw4umDGjBli+6bgEBvSrFDGLlmCwxAc2M+ADWiNR9ppjvMVj5mCA418+umn6ssvvzQxW3qdvG3zRc65AkefPn3U7bffXmTuqr/H8I3DdfYibY/gMARHfeKKo66pgg04cBXhsmXLFP6fWsnbNl/UFxfgMPm2UfdLCg7ppMzqv6t2ivTVsUNwWIADH8K2bt1q9aHUBhwIgC+++EJ99tlnRbEQ1d/xeoLXFNPiAhwDBw5Ut956q5ELUnAYGWmopDORbW20qs9NbjmqNl+PIB0AvK7Y/ItvCw5848C3jlS23WOtBM4RxYdR02ILjqJt80V+ScBhM+lt6hb1QfL3Vn4w47DIOOri2ywKswUHfDh48KDCGakplKFDh7Y8x1Piuy044EPeeR9FvkjAUdRWqn8nOByA46uvvlI4o9SkuABHKtvusb4Bi71sr9m0AQeyw/vvv99kqC7X0QWHScZgUseqM8LKdf8IDgfggPamG+BcgAP2cYM6br2PueCaASwvty2m4MA3qTFjxqgePXpYuaALDisjkVcmOByBAxMX+0ikxRU4YBdXR5r4IPXZ5HmsecFGNhcrbm3A4QJcBAd3x4p2xxZNGJOswyU4sHMXu2djLNiyjq3zLooJOPCKAmjYrruB/zrgiP2Vw3YcmHE4yjgwEKdPn1bffvutaExcggOG16xZU/MjpiLdNl/kuwk4AAzd8z6K7Me2crTIXx9/JzgcggMDJP2FxTU4cEIYTgqLqeA4QBwL6KpIwdHq/lcbXwgOvqo4fVVBMOIbA7536BbX4IBdfCSV+KDrq8lz2ES2cOFC7bMudGxIwYEb7/FR1FUpAgfs6J7t4cqn0O0w43CccWAAJffO+gDHuXPnaqei1zc/hQ6qRnu46qDVNYo2PknAYbqRLc+/om8cRd83iv5uo02ougSHB3D89ttvCms7dP7V8QEOBA+Wwh84cCBUHLW0g0VWuFzJdZGAAz5gwZfLUgQOl7Z02uLuWB2VHD9ju+Q8y51PPvlE6wu+L3DEsO1+zpw5asCAAY5HTCldcPjINtCZGMDhOmuRtseMw0PGgeA6f/58bfNZ165dcyeOL3DA6M6dO9WePXucT1ydBnFhNHbA+ii64IAPJud9FPlsCg7p5Gz2w7Z+Ub/qf9exQ3B4Akd94mK1Yl7xCY4yt93Pmzcv9xpF3SBu9ZwOOGy2zRf5ZgqOonaz/q4zkU3bzqvH3bE56vh6VYFJCF9076xPcMAHHPSDA39ClsGDB6tZs2Z5M6kDjqL7X22cMwGHyeQ3qWPTLwm4mHF4zDgwEDgvA3DIKr7BgYwH2+7xvh+iuNg2X+RnETh07n8tspH3dxNw2NiLsS7B4RkcGPS8pei+wQH7ONQYmU+IMnz48MJLm239KAKHzv2vNj5IwSHJHCTP2vTBtC53x/6vnM9Xlfrg4LyMX3/9teVYhQAHBnvVqlUKp7P7LFjWjW3zWHDls+SBA1c56lxcbeOfFBw2tmKty4wjQMaRl3WEAAfsHz9+XG3YsMFrHI4dO1ZNnDjRqw00ngUOQGP8+PGqW7duXn0gOLjk3PmS86yIzbp3NhQ44JfPbff42XnJkiWFPz+7mNF5GUcIcEnAEfurh+l4MOMIlHFkZR0hweFz2z0ubJZco2gasFkZB3TEyV4hblErAkdVYdE4ZgRHQHBg4iLzaCwhwQG7a9euVadOnbKZt1fVxTcNfNtwcdaFjmOtMg5kPK7O+yjygeDgq0qwV5V6MG7evPmKd/DQ4PCx7R43veOXjFClGRw+F3u16pMuOKqceTDjCJhxIAgxcQ8fPnw5HkODo/7KdOTIESfz3Me2+SLHmsFx/fXXOz3vo8h+ETjq9bPAUQWgEByBwYGgws7V+h6WMsCBbfdvvfWWKloOXzSB8HesEMVK0ZClERw4XR5b90MWXXCE9Cn0DlmCowRwYBUnVpTim0AZ4EBAY/cutv7bFJv7X23sNoIDPmB5eciiA44QWYVrG5L2CI4SwIEg3759e+0XgLLAAbvLly9XWPtgWmzufzW1iXp1cPjaNl/kmw44WrUhmZhZPrhoo6h/+HuRHYKjJHDgNWHbtm21ASrrPpRdu3YpXGFpUvr376/mzp1rUtW6Th0c8KFfv37W7UkbMAWH1E7j80UT2abtvLpZdgmOksCBwcLExb+aZYED2QayjrxNeFlBhZO9bK5RtAl0gOPGG2+0vkrS1AcTcJhOfNN6pn3TzXQIjhLBgaDAqej4r6yyb9++2muTpOAM0dAfJBv9w3oN/AR80003Sdx29qwJOJwZj6QhgqNEcCAGcFbG+++/X1o4SLfdY9s8Ti3Hz7BlFdyP4ut0MZ0+ScEhzRqkz+v47PKZmn8dHR2XXDaaWlshdsfmaXL27Fn14osvejstS2c8sK5EN+sZOXKk9aXNOj5lPYNTzQCORx991KYZq7pScFgZi7QywVFyxgFwPPLII6X+C6q77T7Utvm8uYJzXJ9++umaZmUVgoNLzoMvOW8OdoBj0qRJ6sEHH1QDBw4say6okydPqnXr1uXax0fJe++9tzQf6ye3v/zyy8mAI/bXDtPBZMYRQcYBcPTq1UvNnz9f6y4W08EuqocLq7ERr1Vxff9rkS+t/o6LrnAo0quvvpoEOKoKDYwNwREJODAY06dPd355kGSC4vpKnNnRqgBuLq9RlPiFZxtvp0sFHNI+pvQ8wREROLp3717bnh7iTImsIF2/fv1VW/9j8Gvjxo3q2LFjNbdTAQd+sSpzLH2CiOCICBwY6MmTJ6vRo0f7HPPctnEuKc4nrW+awsPTpk1Tw4YNK82n5kwoFXDkvaqk/hpDcEQGjhi+JeDMkEOHDtVAEeO3lyqAwzWFuTvWtaIF7cWwjgPfDxoLVkZirUJZBcvgcRcLUu3Zs2d7uUZRt2+nT59Wa9asueLxVMCh20fT51xnLZL2mHFElnEgiLp06aIWL16skH2UVbAMHb+w4CrHMsvq1atrhx81lpTBIZmcrXS3ra87lkV2CI4IwYHBHTVqlPf7QfKCCBvf8L2jT58+urHm/DmcUobLrJpLyuAwFaloIpu2W1SPu2MzFIrxVQWu4mv8ggULSt0TUhRUPv+OgF25cmXtZ9iqgMNk8pvU8TEuzX4w44g048Dg33nnnWrGjBk+4iD6Nvfv3187r6RVaceMI7YBIzgiBgeCpcxzL8oKVpwTsmLFCoUl5lUBhyRzkDxbxhhxd6xS0exVyQqAAQMGqDlz5pQRH6XZxKlkOOQoqzDjKG1oLhtmxhF5xoGRKutszzLCU+csVIKjjJG50ibBkQA4yjpNvIzwxM/AOJUsr6QGjthfPUzGmeBIABwY2DLuLzEJKJs6jQvPqgCOKgKjPi4ERyLgiGHptw0UdOriFLLGW+5S/8ZBcOiMeqLPxLqOo5WcU6dOVcOHD09U6Xy3W22uqwI40Aec01q1wowjkYwDgRf6VviQwY7Tx3AKmU5J6RtHVtaRejZCcCQEDkyqiRMnqrFjx+rMr2SewZ4YnD6mW1ICh26fpM+F3g3b7B/BkRg4cFn1kiVLLl9aLQ24GJ/HqWM4c0O3tCs4XGcpNu0RHImBA5Nr3LhxasKECbrzLOrnTpw4oXDqmKSkDA7pZJU+L9Gx8VmpHYIjQXDEcE2BaYA2BytOG8OHUUlJGRy6/ZROZN12i57TtUtwJAgODP6IESNq1yCmXHDKGE4bk5ZUwaEzKXWekepl8nyRHwRHouCI4SpGk4Cs15FePdloK1Vw2OgVW12CI1FwIJAGDx5cW1GaYtm7d6/asWOHkespgiPvX/Cif92NRHJYqZV/BEfC4EBs4Gg/7GVJqWDb/PLlyxU2tJmUFMFh0s+Y6xAciYOjb9++pd47axLcO3fuVHv27DGpWqtDcBhL56wiwZE4OBAJc+fOVf3793cWFD4bqt//evHiRWMzqYEj9lcRk4EgOCoAjt69e9dOCkuhbN26VR04cMDK1ZTAUUVoYPAIjgqAAwM5c+ZMNWTIEKsJ6bty4/2vNrZSAodNP2OuS3BUBBw9e/ZUCxcujHon5qZNm9TRo0et50NK4Kjq/bEER0XAgdk4ZcqU2n0sMRZcqoTLlVyUlMBRf1Wp2isLwVEhcMS87R7XOOI6RxclRXC46He9jbJ3xvIbRwKnnEsDDnfO4u7ZmIp023yR7ymBo6gvun93nbHYtseMo0IZB4IwhntnmyeDdNt80WRKCRw2E9SmbpGGjX83sUNwVAwcCIjRo0eryZMnS2LH27P4GIqPoi5LSuAw6bfJRDax01xHYpfgqCA4cO/sokWLVPfu3V3Ek3EbCMSs+1+NG01o5ahkIkIP6fM2GubV1fGD4KggOBAUw4YNU9OmTfMVW1rt4sRynFzuulQ943Ctl4/2CI6KggNZx1NPPVW79b6sgp9f8TOs65ICOHT+1Y4py8gao6x+EBwVBQcCYfz48bX/yihnzpxR7777rhfTKYDDS8cjapTgqDA4EGdPPvlkKQcbL1u2TOFmNh+F4PChqqxNgqPi4Bg6dKiaPn26LCosnzY5gFhiMnZw6L6mSPoc27MER8XBgYDDdQqhfmHBpHnjjTcUDuvxVWIHh69+x9QuwdEG4MBZHTizI0Q5ePCg2rJli1dTBIdXebUaJzjaAByIhAULFihcXO2z4HAeZBvYEeqzxAyOdnhNwdgSHG0CjhCH/ezatUvt3r3bJzNqbacGjirChOBoE3Bgwj388MOqT58+Xib2hQsXatlGiJIaOFxrwt2xrhU1aG9pG4EDH0jxodRHwQpRrBQNUWIGh6/+u85abNtjxtFG4EBQ46fZQYMGOY1vHAn49ttvO20zr7FUwGE7OW3r6w6IiR2Co83AoRtMMT+XCjhMNTSZyKa2GutJ7BIcBIeLmAvaRgrgkEzCungmdXwIr+MHwUFw+Ig9r22mAA6vAkTQOMFBcEQQhjIXYgeHzr/YsWUZWSPA3bEZyrTTryqy6Rnv07GDI17l3HnGjIMZh7toCtQSwRFI6BwzBAfBUX4UCj2IGRyS1xRht6N6nOAgOKIKSB1nYgaHjv9VeIbgIDiSi2OCo/whIzgIjvKjUOhBrOBol9cUDBfBQXAIp235j6cGjioCheAgOMongdCD1MAh7F4SjxMcBEcSgdroZKzgSE5IC4cJDoLDInzKqZoKOKr4ilIfcYKD4Chn9ltYTQUcFl2MvirBQXBEH6TNDqYAjipnG/xVRSnFvSrJcSPqM0fTU9PMY2YczDjMIqfEWrFnHFXPNphxMOMocfqbm44dHOY9S6cmMw5mHOlE6/+eEhzlDxnBQXCUH4VCD2IGRzu8pvBVha8qwikbx+OxgqNdoEFwEBxxkEDoRazgEHYj6cf5qsJXleQCOFZw4M7czp07J6enicMEB8FhEjel1okVHHxVKTUswhp/7rnnwhpsYe2VV14p3YeUHIh1zAiOlKKIvlIBKhBcgbZ/VQmuOA1SgQooQHBUYBDZBSoQWgGCI7TitEcFKqAAwVGBQWQXqEBoBQiO0IrTHhWogAIERwUGkV2gAqEVIDhCK057VKACChAcFRhEdoEKhFaA4AitOO1VVgGuHK3s0LJjVMCfAgSHP23ZMhWorAIER2WHlh2jAlTAhQL8xuFCRbZBBdpMAYKjzQac3fWrQLu8rhAcfuOIrVOBSipAcFRyWNkpKuBXAYLDr75svQ0VaIfXFYKjDQObXaYCtgoQHLYKsj4VaKFA1bMOgoNhTwWogFgBgkMsGStQAT0Fqpx1EBx6McCnqICRAlWFB8FhFA6sRAXaWwGCo73Hn70PoEAVsw6CI0Dg0AQVqBo8CA7GNBUIpEBV4FHrR0dHx6VAutEMFaACFVGA4KjIQLIbVCCkAgRHSLVpiwr8r0Bqry3N/hIcDGUqUJICqcCjlZ8ER0lBQ7NUAArEDo8s/wgOxi8ViECB2ABS5A/BEUHQ0AUqEFP2UQQN+EpwMGapQGQK6ExcHy5L7BIcPkaAbVIBBwpIJrKNORM7BIeN4qxLBQIpYDK581yzbY/gCDTwNEMFXCmASV8vnTp1KmxW+nxhg/zGoSMRn6ECVKBZAWYcjAkqQAXEChAcYslYgQpQAYKDMUAFqIBYAYJDLBkrUAEqQHAwBqgAFRArQHCIJWMFKkAFCA7GABWgAmIFCA6xZKxABagAwcEYoAJUQKwAwSGWjBWoABUgOBgDVIAKiBUgOMSSsQIVoAIEB2OAClABsQIEh1gyVqACVIDgYAxQASogVoDgEEvGClSAChAcjAEqQAXEChAcYslYgQpQAYKDMUAFqIBYAYJDLBkrUAEqQHAwBqgAFRArQHCIJWMFKkAFCA7GABWgAmIFCA6xZKxABagAwcEYoAJUQKwAwSGWjBWoABUgOBgDVIAKiBUgOMSSsQIVoAIEB2OAClABsQL/AURoVVdDEiHlAAAAAElFTkSuQmCC"
  },
  "description": "Adjust tag behavior based on consent. This template utilizes Google\u0027s Consent API and can be used to adjust how Google\u0027s advertising and analytics use cookies and process ad identifiers.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "SELECT",
    "name": "command",
    "displayName": "Consent Command",
    "categories": ["UTILITY",
    "ANALYTICS",
    "ADVERTISING"],
    "selectItems": [
      {
        "value": "default",
        "displayValue": "Default"
      },
      {
        "value": "update",
        "displayValue": "Update"
      }
    ],
    "simpleValueType": true,
    "help": "\u003cstrong\u003eDefault\u003c/strong\u003e means that you establish consent settings the site falls back on until such a time that the Update command is executed. \u003cstrong\u003eUpdate\u003c/strong\u003e is what you\u0027d use once you\u0027ve retrieved a consent status from the user.",
    "defaultValue": "default",
    "alwaysInSummary": true
  },
  {
    "type": "GROUP",
    "name": "defaultSettings",
    "displayName": "Default Consent Settings",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "PARAM_TABLE",
        "name": "settingsTable",
        "paramTableColumns": [
          {
            "param": {
              "type": "SELECT",
              "name": "ad_storage",
              "displayName": "Advertising",
              "macrosInSelect": true,
              "selectItems": [
                {
                  "value": "granted",
                  "displayValue": "granted"
                },
                {
                  "value": "denied",
                  "displayValue": "denied"
                }
              ],
              "simpleValueType": true,
              "defaultValue": "granted",
              "help": "Accept: false, denied, true, granted.\nIf set to \u003cstrong\u003edenied or false\u003c/strong\u003e, Google\u0027s advertising tags and pixels will not be able to read or write first-party cookies. The use of third-party cookies is limited to only spam and fraud detection purposes. \u003ca href\u003d\"https://support.google.com/analytics/answer/9976101#behavior\"\u003eMore information\u003c/a\u003e"
            },
            "isUnique": false
          },
          {
            "param": {
              "type": "SELECT",
              "name": "analytics_storage",
              "displayName": "Analytics",
              "macrosInSelect": true,
              "selectItems": [
                {
                  "value": "granted",
                  "displayValue": "granted"
                },
                {
                  "value": "denied",
                  "displayValue": "denied"
                }
              ],
              "simpleValueType": true,
              "defaultValue": "granted",
              "help": "Accept: false, denied, true, granted.\nAccept: false, denied, true, granted.\nIf set to \u003cstrong\u003e denied or false \u003c/strong\u003e, Google Analytics tags will not read or write analytics cookies, and data collected in Google Analytics will not use persistent cookie IDs (IDs are reset each time the page is loaded). \u003ca href\u003d\"https://support.google.com/analytics/answer/9976101#behavior\"\u003e Learn more \u003c/a\u003e."
            },
            "isUnique": false
          },
          {
            "param": {
              "type": "SELECT",
              "name": "personalization_storage",
              "displayName": "Personalization",
              "macrosInSelect": true,
              "selectItems": [
                {
                  "value": "granted",
                  "displayValue": "granted"
                },
                {
                  "value": "denied",
                  "displayValue": "denied"
                }
              ],
              "simpleValueType": true,
              "defaultValue": "granted",
              "help": "Accept: false, denied, true, granted."
            },
            "isUnique": false
          },
          {
            "param": {
              "type": "TEXT",
              "name": "wait_for_update",
              "displayName": "Wait for update",
              "simpleValueType": true,
              "valueUnit": "milliseconds",
              "defaultValue": 0,
              "help": "If your CMP loads asynchronously, it might not always run before your Google Tags. To handle such situations, specify wait_for_update along with a millisecond value to control \u003cstrong\u003ehow long to wait before data is sent\u003c/strong\u003e.",
              "valueValidators": [
                {
                  "type": "NON_NEGATIVE_NUMBER"
                }
              ]
            },
            "isUnique": false
          },
          {
            "param": {
              "type": "TEXT",
              "name": "regions",
              "displayName": "Regions",
              "simpleValueType": true,
              "defaultValue": "all",
              "help": "Apply this setting to users from these \u003ca href\u003d\"https://en.wikipedia.org/wiki/ISO_3166-2\"\u003eregions\u003c/a\u003e (provide a comma-separated list). If you select \u003cstrong\u003eall\u003c/strong\u003e, the setting will apply to all users."
            },
            "isUnique": false
          }
        ],
        "newRowButtonText": "Add Setting",
        "editRowTitle": "Edit Setting",
        "newRowTitle": "Add Setting",
        "valueValidators": [
          {
            "type": "TABLE_ROW_COUNT",
            "args": [
              1
            ],
            "errorMessage": "You must add at least one default setting."
          }
        ]
      }
    ],
    "enablingConditions": [
      {
        "paramName": "command",
        "paramValue": "default",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "updateSettings",
    "displayName": "Update Consent Settings",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "SELECT",
        "name": "update_ad_storage",
        "displayName": "Advertising",
        "macrosInSelect": true,
        "selectItems": [
          {
            "value": "granted",
            "displayValue": "granted"
          },
          {
            "value": "denied",
            "displayValue": "denied"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "granted",
        "help": "Accept: false, denied, true, granted.\nIf set to \u003cstrong\u003edenied or false\u003c/strong\u003e, Google\u0027s advertising tags and pixels will not be able to read or write first-party cookies. The use of third-party cookies is limited to only spam and fraud detection purposes. \u003ca href\u003d\"https://support.google.com/analytics/answer/9976101#behavior\"\u003eMore information\u003c/a\u003e."
      },
      {
        "type": "SELECT",
        "name": "update_analytics_storage",
        "displayName": "Analytics",
        "macrosInSelect": true,
        "selectItems": [
          {
            "value": "granted",
            "displayValue": "granted"
          },
          {
            "value": "denied",
            "displayValue": "denied"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "granted",
        "help": "Accept: false, denied, true, granted.\nIf set to \u003cstrong\u003e denied or false \u003c/strong\u003e, Google Analytics tags will not read or write analytics cookies, and data collected in Google Analytics will not use persistent cookie IDs (IDs are reset each time the page is loaded). \u003ca href\u003d\"https://support.google.com/analytics/answer/9976101#behavior\"\u003e Learn more \u003c/a\u003e."
      },
      {
        "type": "SELECT",
        "name": "update_personalization_storage",
        "displayName": "Personalization",
        "macrosInSelect": true,
        "selectItems": [
          {
            "value": "granted",
            "displayValue": "granted"
          },
          {
            "value": "denied",
            "displayValue": "denied"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "granted",
        "help": "Accept: false, denied, true, granted."
      }
    ],
    "enablingConditions": [
      {
        "paramName": "command",
        "paramValue": "update",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "other",
    "displayName": "Other Settings",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "url_passthrough",
        "checkboxText": "Pass Ad Click Information Through URLs",
        "simpleValueType": true,
        "help": "Check this if you want internal links to pass advertising identifiers (\u003cstrong\u003egclid\u003c/strong\u003e, \u003cstrong\u003edclid\u003c/strong\u003e, \u003cstrong\u003egclsrc\u003c/strong\u003e, \u003cstrong\u003e_gl\u003c/strong\u003e) in the link URL while waiting for consent to be granted."
      },
      {
        "type": "CHECKBOX",
        "name": "ads_data_redaction",
        "checkboxText": "Redact Ads Data",
        "simpleValueType": true,
        "help": "If this is checked \u003cstrong\u003eand\u003c/strong\u003e Advertising consent status is \u003cstrong\u003edenied\u003c/strong\u003e, Google\u0027s advertising tags will drop all advertising identifiers from the requests, and traffic will be routed through cookieless domains."
      },
      {
        "type": "CHECKBOX",
        "name": "sendDataLayer",
        "checkboxText": "Push dataLayer Event",
        "simpleValueType": true,
        "help": "When consent is set to \"default\", a dataLayer event with \u003cstrong\u003eevent: \u0027gtm_consent_default\u0027\u003c/strong\u003e is sent, together with consent state for both \u003cstrong\u003ead_storage\u003c/strong\u003e and \u003cstrong\u003eanalytics_storage\u003c/strong\u003e. When an \"update\" is fired, a dataLayer event with \u003cstrong\u003eevent: \u0027gtm_consent_update\u0027\u003c/strong\u003e is pushed together with details about the updated consent state."
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const dataLayerPush = require('createQueue')('dataLayer');
const gtag = require('createArgumentsQueue')('gtag', 'dataLayer');
const log = require('logToConsole');
const setDefaultConsentState = require('setDefaultConsentState');
const updateConsentState = require('updateConsentState');

// Set advanced settings
if (data.url_passthrough) gtag('set', 'url_passthrough', true);
if (data.ads_data_redaction) gtag('set', 'ads_data_redaction', true);

const getState = (consent) => {
    return consent === true ? 'granted' : 'denied';
};

// dataLayer.push helper
const dlPush = (isDefault, ads, analytics, personalization, wait_for_update, region) => {
  dataLayerPush({
    event: 'gtm_consent_' + (isDefault ? 'default' : 'update'),
    ad_storage: ads,
    analytics_storage: analytics,
    personalization_storage: personalization,
    consent_region: region,
    wait_for_update: wait_for_update
  });
};

// Process default consent state
if (data.command === 'default') {
  data.settingsTable.forEach(setting => {
    const settingObject = {
      ad_storage: getState(setting.ad_storage),
      analytics_storage: getState(setting.analytics_storage),
      personalization_storage: getState(setting.personalization_storage),
      wait_for_update: setting.wait_for_update
    };
    if (setting.regions !== 'all') {
      settingObject.region = setting.regions.split(',').map(r => r.trim());
    }
    setDefaultConsentState(settingObject);
    gtag('consent', 'default', settingObject);
    if (data.sendDataLayer) {
      dlPush(true,
        settingObject.ad_storage,
        settingObject.analytics_storage,
        settingObject.personalization_storage,
        settingObject.wait_for_update,
        settingObject.region
      );
    }
  });
}

// Process updated consent state
if (data.command === 'update') {
  const settingObject = {
    ad_storage: getState(data.update_ad_storage),
    analytics_storage: getState(data.update_analytics_storage),
    personalization_storage: getState(data.update_personalization_storage),
    wait_for_update: data.wait_for_update
  };

  gtag('consent', 'update', settingObject);
  updateConsentState(settingObject);
  if (data.sendDataLayer) {
    dlPush(false, settingObject.update_ad_storage, settingObject.update_analytics_storage, settingObject.update_personalization_storage, settingObject.wait_for_update);
  }
}

// Call data.gtmOnSuccess when the tag is finished.
data.gtmOnSuccess();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "gtag"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "dataLayer"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_consent",
        "versionId": "1"
      },
      "param": [
        {
          "key": "consentTypes",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "analytics_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wait_for_update"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "personalization_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: gtag command created
  code: |-
    mock('createArgumentsQueue', (cmd, arr) => {
      assertThat(cmd).isEqualTo('gtag');
      assertThat(arr).isEqualTo('dataLayer');
      return () => {};
    });

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();
- name: default settings sent
  code: |-
    let index = 1;
    mock('createArgumentsQueue', () => {
      return function() {
        if (arguments[0] === 'consent' && index === 1) {
          assertThat(arguments[2]).isEqualTo({
            ad_storage: 'granted',
            analytics_storage: 'denied',
            personalization_storage: 'denied',
            wait_for_update: 500
          });
          index++;
        } else if (arguments[0] === 'consent' && index === 2) {
          assertThat(arguments[2]).isEqualTo({
            ad_storage: 'denied',
            analytics_storage: 'granted',
            personalization_storage: 'granted',
            wait_for_update: 1000,
            region: ['ES', 'US-AK']
          });
        }
      };
    });
    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('setDefaultConsentState').wasCalledWith({
      ad_storage: 'granted',
      analytics_storage: 'denied',
      personalization_storage: 'denied',
      wait_for_update: 500
    });
    assertApi('setDefaultConsentState').wasCalledWith({
      ad_storage: 'denied',
      analytics_storage: 'granted',
      personalization_storage: 'granted',
      region: ['ES', 'US-AK'],
      wait_for_update: 1000
    });
    assertApi('gtmOnSuccess').wasCalled();
- name: updated settings sent
  code: |-
    mockData.command = 'update';

    mock('createArgumentsQueue', () => {
      return function() {
        if (arguments[0] === 'consent') {
          assertThat(arguments[2]).isEqualTo({
            ad_storage: 'denied',
            analytics_storage: 'granted',
            personalization_storage: 'granted'
          });
        }
      };
    });
    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('updateConsentState').wasCalledWith({
      ad_storage: 'denied',
      analytics_storage: 'granted',
      personalization_storage: 'granted'
    });
    assertApi('gtmOnSuccess').wasCalled();
- name: extra settings sent
  code: |-
    mock('createArgumentsQueue', () => {
      return function() {
        if (arguments[0] === 'set' && arguments[1] === 'url_passthrough') assertThat(arguments[2]).isEqualTo(true);
        if (arguments[0] === 'set' && arguments[1] === 'ads_data_redaction') assertThat(arguments[2]).isEqualTo(true);
      };
    });
    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();
- name: dataLayer events generated
  code: "mockData.sendDataLayer = true;\n\nlet dlCalled = 0;\n\nmock('createQueue',\
    \ name => {\n  return o => {\n    require('logToConsole')(o);\n    if (o.event\
    \ === 'gtm_consent_default' && o.ad_storage === 'granted' && o.analytics_storage\
    \ === 'denied' && o.personalization_storage === 'denied') dlCalled++;\n    if\
    \ (o.event === 'gtm_consent_default' && o.ad_storage === 'denied' && o.analytics_storage\
    \ === 'granted' && o.personalization_storage === 'granted' && o.consent_region.join()\
    \ === 'ES,US-AK') dlCalled++;\n  };\n});\n    \n// Call runCode to run the template's\
    \ code.\nrunCode(mockData);\n\n// Verify that the tag finished successfully.\n\
    assertApi('gtmOnSuccess').wasCalled();\nassertThat(dlCalled, 'dataLayer not called\
    \ with correct arguments').isEqualTo(2);"
setup: |-
  const mockData = {
    command: 'default',
    settingsTable: [{
      ad_storage: 'granted',
      analytics_storage: 'denied',
      personalization_storage: 'denied',
      wait_for_update: 500,
      regions: 'all'
    },{
      ad_storage: 'denied',
      analytics_storage: 'granted',
      personalization_storage: 'granted',
      wait_for_update: 1000,
      regions: 'ES, US-AK'
    }],
    update_analytics_storage: 'granted',
    update_ad_storage: 'denied',
    update_personalization_storage: 'granted',
    url_passthrough: true,
    ads_data_redaction: true,
    sendDataLayer: false
  };


___NOTES___

Created on 21/2/2022, 11:48:11


